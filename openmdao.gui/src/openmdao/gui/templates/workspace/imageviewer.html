<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">

<META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>{% block title %} OpenMDAO Image Viewer: {{ current_user }} {% end %}</title>
</head>

<body bgcolor="Grey">
    <link rel="stylesheet" href="/static/css/mdao-layout.css">
    <link rel="stylesheet" href="/static/css/mdao-styles.css">

    <!-- modernizr -->
    <script src="/static/js/modernizr.js"></script>

    <!-- jQuery -->
    <link rel="stylesheet" href="/static/css/ui-openmdao/jquery-ui-1.8.21.custom.css">
    <script src="/static/js/jquery-1.8.2.min.js"></script>
    <script src="/static/js/jquery-ui-1.9.1.min.js"></script>

    <!--  ben alman's debug script (for development only, remove for flight)  -->
    <script src="/static/js/ba-debug.min.js"></script>

    <!-- galleria -->
    <link type="text/css" rel="stylesheet" href="/static/js/galleria/themes/classic/galleria.classic.css">
    <script type="text/javascript" src="/static/js/galleria/galleria-1.2.9.min.js"></script>
    <script type="text/javascript" src="/static/js/galleria/themes/classic/galleria.classic.min.js"></script>

    <!-- openmdao specific imports -->
    <script src="/static/js/openmdao/BaseFrame.js"></script>

    <script>
        jQuery(function() {
            // define openmdao namespace & create interface to openmdao in global scope
            openmdao = (typeof openmdao === 'undefined' || !openmdao ) ? {} : openmdao ;
            if (opener && opener.openmdao && opener.openmdao.project ) {
                openmdao.project = opener.openmdao.project;
            }
            else {
                openmdao.project = new openmdao.Project();
            }

            openmdao.project.getFiles()
                .done(function(files) {
                    var data = [],
                        index = 0,
                        show_index = 0;
                    for (var file in files) {
                        if (/.png$/.test(file) || /.jpg$/.test(file) || /.gif$/.test(file)) {
                            data.push({
                                title: file,
                                image: '/workspace/file'+file
                            });
                            if (file === "{{ filename }}") {
                                show_index = index;
                            }
                            index++;
                        }
                    }
                    jQuery('#images').galleria({
                        dataSource: data,
                        width: jQuery(window).width(),
                        height: jQuery(window).height(),
                        responsive: true,   // TODO: need dynamic CSS
                        show: show_index
                    });
                })
                .fail(function(jqXHR, textStatus, errorThrown) {
                    debug.error('Error getting files',
                                jqXHR, textStatus, errorThrown);
                });
        });
    </script>

    <div id="images">
    </div>

</body>

</html>
